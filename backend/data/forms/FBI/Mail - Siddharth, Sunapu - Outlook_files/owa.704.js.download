self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.704.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[704],{13696:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(209),a=n(224),i=n(29),s=n(271),c=n(11),u=n(12);function d(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o;return r.__generator(this,function(r){return 1===(n=t.tableQuery).listViewType?(o={Id:e,mailboxInfo:Object(a.c)(n)},[2,Object(s.i)(o,"LoadNudgedItem")]):[2,l(e,t)]})})}function l(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,d;return r.__generator(this,function(r){return n=t.tableQuery,d=Object(a.c)(n),[2,i.E.importAndExecute(Object(u.i)(n),e,Object(o.e)(n),n.requestShapeName,d.requestOptions).then(function(t){if("Success"==t.ResponseClass){var n=t.Conversations;if(n&&n.length>0&&n[0].ConversationId.Id===e){var r={Id:e,mailboxInfo:d};return Object(s.h)(r,"LoadNudgedConversation"),n[0]}}return null}).catch(function(e){return c.c.warn("loadNudgedConversation throws an exception"+e.message),null})]})})}var b=n(86),f=n(67),w="FocusedInbox/api/v1/Nudges/GetNudges";function O(){return r.__awaiter(this,void 0,void 0,function(){var e;return r.__generator(this,function(t){switch(t.label){case 0:return[4,Object(f.b)(w,Object(b.a)(),!0)];case 1:e=t.sent(),t.label=2;case 2:return t.trys.push([2,4,,5]),[4,e.json()];case 3:return[2,t.sent()];case 4:return t.sent(),[2,null];case 5:return[2]}})})}var I=n(19),g=n(28);function v(e){switch(e){case"Received":return 0;case"Sent":return 1;default:return c.c.warn("No nudge reason returned in GetNudge server response"),0}}var h=n(5),m=n(726),j=n(1192),y=n(5758);function p(e){if(!Object(h.e)("tri-nudge")||Object(y.a)(16))return!1;if(e===Object(g.a)("inbox")||e===Object(g.a)("sentitems")){var t=Object(m.a)(e),n={sortColumn:1,sortDirection:j.DESCENDING_SORT_DIR};return t.sortColumn==n.sortColumn&&t.sortDirection==n.sortDirection}return!1}var _=n(816),N=n(1930),K=n(299);function C(e,t){var n=t.rowKeys.indexOf(e);if(n>=0&&!u.b.getIsPinned(e,t)){var r=Object(N.a)(u.b.getLastDeliveryOrRenewTimeStamp(e,t),u.b.getLastDeliveryTimeStamp(e,t),t,n+1,!0);-1==r?Object(_.a)([e],t):K.a.updateRowPosition(--r,e,t)}}var S=n(3),R=n(918),V=n(252),x=n(556),D=n(142),F=!1,A=Object(S.e)(R.a,"clone_onSelectFolderComplete",function(e){return r.__awaiter(void 0,void 0,void 0,function(){var t,n,o,a,i,s;return r.__generator(this,function(c){switch(c.label){case 0:return F||!p(e.selectedFolderId)?[2]:(t=Object(u.C)()).tableQuery.folderId!=e.selectedFolderId?[2]:(F=!0,[4,O()]);case 1:if(n=c.sent(),o=[],!n||!n.Nudges)return[3,5];a=n.Nudges,i=0,c.label=2;case 2:return i<a.length?[4,P(a[i],t)]:[3,5];case 3:(s=c.sent())&&o.push(s),c.label=4;case 4:return i++,[3,2];case 5:return o.push.apply(o,r.__spread(function(e){var t=Object(I.a)("testNudge");if(0==decodeURIComponent(t||"").trim().length)return[];if(e.rowKeys.length>0){var n=e.tableQuery.folderId===Object(g.a)("sentitems")?1:0,r={rowKey:e.rowKeys[0],itemId:u.b.getItemIds(e.rowKeys[0],e)[0],conversationId:u.b.getConversationId(e.rowKeys[0],e),tableViewId:e.id,reason:n,daysAgo:5};return e.rowKeys.length>10&&1===Math.floor(2*Math.random())?[r,{rowKey:e.rowKeys[10],itemId:u.b.getItemIds(e.rowKeys[10],e)[0],conversationId:u.b.getConversationId(e.rowKeys[10],e),tableViewId:e.id,reason:n,daysAgo:3}]:[r]}return[]}(t))),Object(x.d)().nudgedRows.forEach(function(e){o.some(function(t){return t.rowKey===e.rowKey&&t.tableViewId===e.tableViewId})||C(e.rowKey,t)}),o.forEach(function(e){return function(e,t){if(!u.b.getIsPinned(e,t)){var n=Object(V.f)(t,0);K.a.updateRowPosition(n,e,t)}}(e.rowKey,t)}),Object(x.g)(o),F=!1,[2]}})})});function P(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o,i,l,b,f,w,O;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),e.FolderId.Id!=t.tableQuery.folderId?[2,null]:(n=e.ItemId.Id,o=e.ConversationId.Id,i=0===t.tableQuery.listViewType?o:n,l=void 0,0!==(b=Object(u.B)([i],t)).length?[3,2]:[4,d(i,t)]);case 1:return(f=r.sent())?(l=f.InstanceKey,t.rowKeys.indexOf(l)<0&&(w=Object(V.f)(t,0),K.a.addRow(w,f,t)),[3,3]):(c.c.warn("Unable to load nudged row for list view type:"+t.tableQuery.listViewType),[2,null]);case 2:l=b[0],function(e,t){if(1===e.listViewType){var n=Object(D.b)().items.get(t);n&&n.NormalizedBody||Object(s.i)({Id:t,mailboxInfo:Object(a.c)(e)},"LoadNudgedItem")}else Object(D.b)().conversations.get(t)||Object(s.h)({Id:t,mailboxInfo:Object(a.c)(e)},"LoadNudgedConversation")}(t.tableQuery,i),r.label=3;case 3:return[2,{rowKey:l,itemId:n,conversationId:o,tableViewId:t.id,reason:v(e.NudgeReason.Reason),daysAgo:e.NudgeReason.EmailAgeInDays}];case 4:return O=r.sent(),c.c.warn("processNudgeResponse throws an exception"+O.message),[2,null];case 5:return[2]}})})}var U=n(237),E="FocusedInbox/api/v1/Nudges/UpdateNudges";function Q(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o;return r.__generator(this,function(r){switch(r.label){case 0:return n={ItemId:{Id:e},NudgeAction:t},[4,Object(f.d)(E,n,Object(b.a)())];case 1:o=r.sent();try{Object(U.a)(o.status)||c.c.warn("updateNudgesOperation return http status "+o.status)}catch(e){return c.c.info("updateNudgesOperation return error "+e.message),[2,null]}return[2]}})})}var B=n(843),L=n(1673),M=n(1672),T=n(2656),k=n(2657),G=Object(S.e)(k.a,"clone_onDismissNudgeInfoBar",function(e){Q(e.itemId,"Dismissed"),Object(x.h)(e.rowKey),C(e.rowKey,Object(u.C)())}),q=Object(S.e)(B.a,"clone_deleteItemsStoreUpdate",function(e){e.itemContexts.map(function(e){return e.itemId}).forEach(function(e){var t=Object(x.b)(e);t&&Object(x.h)(t)})}),$=Object(S.e)(_.a,"clone_removeRowsFromListViewStore",function(e){W(e.rowKeys,e.tableView.id)}),z=Object(S.e)(M.a,"clone_markItemsAsPinnedStoreUpdate",function(e){X(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned),e.shouldMarkAsPinned&&W(e.rowKeys,e.tableViewId)}),H=Object(S.e)(L.a,"clone_markConversationsAsPinnedStoreUpdate",function(e){X(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned),e.shouldMarkAsPinned&&W(e.rowKeys,e.tableViewId)}),J=Object(S.e)(T.a,"clone_onSendMessageSucceeded",function(e){if(1===e.operation||2===e.operation||3===e.operation){var t=Object(x.b)(e.referenceItemId.Id);t&&Object(x.h)(t)}});function W(e,t){e.forEach(function(e){Object(x.e)(e,t)&&Object(x.h)(e)})}function X(e,t,n){e.forEach(function(e){var r=Object(x.d)().nudgedRows.filter(function(n){return n.rowKey===e&&n.tableViewId==t});1==r.length&&Q(r[0].itemId,n?"Pinned":"Unpinned")})}n.d(t,"getNudgesOrchestrator",function(){return A}),n.d(t,"removeNudgeOnDismissOrchestrator",function(){return G}),n.d(t,"removeNudgeOnItemDeleteStoreUpdateOrchestrator",function(){return q}),n.d(t,"removeNudgeOnRowsDeleteStoreUpdateOrchestrator",function(){return $}),n.d(t,"removeNudgeOnItemsPinnedStoreUpdateOrchestrator",function(){return z}),n.d(t,"removeNudgeOnConversationsPinnedStoreUpdateOrchestrator",function(){return H}),n.d(t,"removeNudgeOnReplyOrReplyAllOrForwardOrchestrator",function(){return J})},5758:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i});var r=n(26),o=n(8);function a(e){return!!(e&Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags)}var i=Object(o.action)("setBit")(function(e,t){a(t)!==e&&(e?Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags|=t:Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags&=~t)})}},0,[3,21,34,79,330,6,7,9,11,119,1,4,5,309,310,8,23,314,542,378,544,383,12,43,115,486,98,70,110,498,167,499,171,530,321,213,299,308,468,470,606]]);
//# sourceMappingURL=owa.704.js.map
self.scriptsLoaded['owa.704.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.704.js'] = (new Date()).getTime();